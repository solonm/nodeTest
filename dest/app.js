var redisClient=require("./redis.js"),encryption=require("./encryption.js"),express=require("express"),app=express(),gulp=require("gulp"),gulpIgnore=require("gulp-ignore"),uglify=require("gulp-uglify"),jshint=require("gulp-jshint"),redis=require("redis"),db=require("mysql-promise")();db.configure({host:"localhost",user:"root",password:"salamina",database:"NODE_CMS"});var bodyParser=require("body-parser");app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.json()),app.use(express.urlencoded());var path=require("path"),compression=require("compression");app.use(compression()),app.use(express["static"](path.join(__dirname,"public"))),app.get("/",function(e,r){console.log("Request received: "+e.url),r.sendfile("views/index.html",{root:__dirname})}),app.get("/generic",function(e,r){console.log("Request received: "+e.url),r.sendfile("views/generic.html",{root:__dirname})}),app.get("/elements",function(e,r){console.log("Request received: "+e.url),r.sendfile("views/elements.html",{root:__dirname})}),app.get("/login",function(e,r){console.log("Request received: "+e.url),r.sendfile("views/login.html",{root:__dirname})}),app.get("/js*",function(e,r){console.log("Request received: "+e.url),r.sendfile("views"+e.url,{root:__dirname})}),app.get("/css*",function(e,r){console.log("Request received: "+e.url),r.sendfile("views"+e.url,{root:__dirname})}),app.get("/fonts*",function(e,r){console.log("Request received: "+e.url.split("?")[0]),r.sendfile("views"+e.url.split("?")[0],{root:__dirname})}),app.get("/images*",function(e,r){console.log("Request received: "+e.url),r.sendfile("views"+e.url,{root:__dirname})}),app.post("/loginUser",function(e,r){console.log("Request received: "+e.url);var s=e.body.username,o=e.body.password;db.query('SELECT * FROM Users where username="'+s+'" and password="'+o+'"').spread(function(e){if(e.length>0){var s=encryption.encrypt(e[0]).toString();redisClient.set(s,!0,redis.print);var o={Code:200,Message:"logged In",Token:s};r.send(o)}console.log("Hello users",e)})}),app.post("/logoutUser",function(e,r){console.log("Request received: "+e.url);var s=e.body.Token;console.log(s);var o=encryption.decrypt(s);console.log(o),redisClient.del(s);var n={Code:200,Message:"logged Out",Token:""};r.send(n)}),app.listen("8080"),console.log("App started on port 8080");